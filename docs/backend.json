{
  "entities": {
    "Poll": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Poll",
      "type": "object",
      "description": "Represents a poll with questions, options, and status.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Poll entity."
        },
        "question": {
          "type": "string",
          "description": "The question being asked in the poll."
        },
        "options": {
          "type": "array",
          "description": "The possible options/answers for the poll question.",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "The current status of the poll (e.g., open, closed)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User that created the poll. (Relationship: User 1:N Poll)"
        },
        "pollType": {
          "type": "string",
          "description": "The type of poll, either single or multiple choice.",
          "enum": ["single", "multiple"]
        },
        "maxChoices": {
          "type": "number",
          "description": "The maximum number of options a user can select in a multiple choice poll."
        }
      },
      "required": [
        "id",
        "question",
        "options",
        "status",
        "userId",
        "pollType"
      ]
    },
    "Voter": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Voter",
      "type": "object",
      "description": "Represents a voter and their eligibility/voting status for a specific poll.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Voter entity."
        },
        "pollId": {
          "type": "string",
          "description": "Reference to the Poll this voter is associated with. (Relationship: Poll 1:N Voter)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User. (Relationship: User 1:1 Voter). Note:  This User may be managed by an external authentication system."
        },
        "isEligible": {
          "type": "boolean",
          "description": "Indicates whether the voter is eligible to vote in the poll."
        },
        "hasVoted": {
          "type": "boolean",
          "description": "Indicates whether the voter has already voted in the poll."
        }
      },
      "required": [
        "id",
        "pollId",
        "userId",
        "isEligible",
        "hasVoted"
      ]
    },
    "Vote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vote",
      "type": "object",
      "description": "Represents an anonymous vote cast in a poll.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vote entity."
        },
        "pollId": {
          "type": "string",
          "description": "Reference to the Poll this vote belongs to. (Relationship: Poll 1:N Vote)"
        },
        "selectedOptions": {
          "type": "array",
          "description": "The options selected by the voter.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "pollId",
        "selectedOptions"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, matches Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Collection for storing user profiles. Document ID is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/polls/{pollId}",
        "definition": {
          "entityName": "Poll",
          "schema": {
            "$ref": "#/backend/entities/Poll"
          },
          "description": "Collection for storing polls created by users.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who created the poll."
            },
            {
              "name": "pollId",
              "description": "The unique identifier for the poll."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/polls/{pollId}/voters/{voterId}",
        "definition": {
          "entityName": "Voter",
          "schema": {
            "$ref": "#/backend/entities/Voter"
          },
          "description": "Subcollection for storing voters associated with a specific poll.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who created the poll."
            },
            {
              "name": "pollId",
              "description": "The unique identifier for the poll."
            },
            {
              "name": "voterId",
              "description": "The unique identifier for the voter."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/polls/{pollId}/votes/{voteId}",
        "definition": {
          "entityName": "Vote",
          "schema": {
            "$ref": "#/backend/entities/Vote"
          },
          "description": "Subcollection for storing votes cast in a specific poll.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who created the poll."
            },
            {
              "name": "pollId",
              "description": "The unique identifier for the poll."
            },
            {
              "name": "voteId",
              "description": "The unique identifier for the vote."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed around user ownership. All user-generated content (polls, groups) is stored under a main `/users/{userId}` collection, making security rules simple and scalable. A separate root `/polls` collection holds public, non-sensitive poll data for voters to read, which is only written to by secure server-side actions."
  }
}
